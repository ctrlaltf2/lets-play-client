!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";var o={trueWidth:-1,trueHeight:-1,onUpdate:function(e){let t=new Uint8Array(e);var n=Array.prototype.map.call(t,function(e){return String.fromCharCode(e)}).join("");let o=btoa(n);var a=new Image;a.addEventListener("load",function(){var e=document.getElementById("screen");if(e.getContext){if(trueWidth!=a.width||trueHeight!=a.height){trueWidth=a.width,trueHeight=a.height;let t=a.width/a.height,n=parseFloat(getComputedStyle(document.documentElement).fontSize),o=parseFloat(window.getComputedStyle(document.getElementsByClassName("display-container")[0]).height)-2*n,r=t*o,d=o;e.width=r,e.height=d,document.getElementById("screen").style.height=d+"px !important",document.getElementById("screen").style.width=r+"px !important"}var t=e.getContext("2d");t.imageSmoothingEnabled=!1,t.drawImage(a,0,0,e.width,e.height)}}),a.src="data:image/jpeg;base64,"+o}};t.a=o},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _video_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_gamepad_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),app={username:"",pendingUsername:"",waitingUsernameValid:!1,input:{gamepad:{connected:!1,layout:{},onconnect:function(e){0===e.gamepad.index&&("standard"==e.gamepad.mapping?(app.input.gamepad.layout=_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.maps.standard,app.input.gamepad.connected=!0,app.input.gamepad.pollInput()):gamepadMaps[e.gamepad.id]?(app.input.gamepad.layout=_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.maps[e.gamepad.id],app.input.gamepad.connected=!0,app.input.gamepad.pollInput()):alert("Unknown controller plugged in"))},ondisconnect:function(e){0===e.gamepad.index&&(app.input.gamepad.connected=!1,app.input.gamepad.buttonstate=[],cancelAnimationFrame(app.input.gamepad.pollInputID))},buttonstate:[],axesstate:[],pollInputID:void 0,pollInput:function(){if(!0===app.input.gamepad.connected){let e=navigator.getGamepads()[0];if(app.input.gamepad.lastPolledTimestamp==e.timestamp)return void(app.input.gamepad.pollInputID=requestAnimationFrame(app.input.gamepad.pollInput));app.input.gamepad.lastPolledTimestamp=e.timestamp;let t=app.input.gamepad.layout;if(t){for(let n=0;n<t.buttons.length;++n)void 0==app.input.gamepad.buttonstate[n]&&(app.input.gamepad.buttonstate[n]=!1),e.buttons[n].pressed!=app.input.gamepad.buttonstate[n]&&(e.buttons[n].pressed?connection.readyState==connection.OPEN&&connection.send(encodeCommand(["button","down",t.buttons[n]+""])):connection.readyState==connection.OPEN&&connection.send(encodeCommand(["button","up",t.buttons[n]+""]))),app.input.gamepad.buttonstate[n]=e.buttons[n].pressed;for(let n=0;n<t.axes.length;++n){let o;o=Math.abs(e.axes[n])>joystickThreshold?e.axes[n]<0?-1:1:0,void 0==app.input.gamepad.axesstate[n]&&(app.input.gamepad.axesstate[n]=0);let a=app.input.gamepad.axesstate[n];a!=o&&(0==a?connection.readyState==connection.OPEN&&connection.send(encodeCommand(["button","down",t.axes[n].getRetroID(o)+""])):0==o?connection.readyState==connection.OPEN&&connection.send(encodeCommand(["button","up",t.axes[n].getRetroID(a)+""])):connection.readyState==connection.OPEN&&(connection.send(encodeCommand(["button","up",t.axes[n].getRetroID(a)+""])),connection.send(encodeCommand(["button","down",t.axes[n].getRetroID(o)+""])))),app.input.gamepad.axesstate[n]=o}}else console.log("layout not setup")}app.input.gamepad.pollInputID=requestAnimationFrame(app.input.gamepad.pollInput)},lastPolledTimestamp:0},keyToRetroID:{x:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.B,c:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.A,s:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.X,a:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.Y,ArrowUp:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.Up,ArrowDown:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.Down,ArrowLeft:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.Left,ArrowRight:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.Right,Tab:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.Select,Enter:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.Start,q:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.L,e:_gamepad_js__WEBPACK_IMPORTED_MODULE_1__.a.retroJoypad.R}},chat:{log:function(e,t){let n=document.getElementById("chat-list-items"),o=document.createElement("div");o.className="chat-item",o.innerHTML='<p class="username">'+e+'</p><p class="separator">:</p><span class="chat-text">'+t+"</span>",n.appendChild(o),n.scrollTop=n.scrollHeight}},onchat:function(command){let message=command[2].replace(/(\\x[\da-f]{2}|\\u[\da-f]{4}|\\u{1[\da-f]{4}})+/g,function a(x){return eval("'"+x+"'")});app.chat.log(command[1],command[2])},onlist:function(e){app.chat.log("[Server]","Users online: "+(e.length-1))}},connection;function decodeCommand(e){var t=-1,n=[];for(let a=0;a<25;++a){var o=e.indexOf(".",t+1);if(-1==o)break;if(t=parseInt(e.slice(t+1,o))+o+1,n.push(e.slice(o+1,t).replace(/&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&#x2F;/g,"/").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),";"==e.slice(t,t+1))break}return n}function encodeCommand(e){for(var t="",n=0;n<e.length;n++){var o=e[n];t+=o.length+"."+o,t+=n<e.length-1?",":";"}return t}function setUsername(e,t){!0===t?(document.cookie="username="+e,app.username=e,app.waitingUsernameValid=!1):connection.readyState==connection.OPEN&&(app.pendingUsername=e,app.waitingUsernameValid=!0,connection.send(encodeCommand(["username",e])))}function getUsername(){return document.cookie.split(";").filter(function(e){return e.indexOf("username=")>=0}).length?document.cookie.replace(/(?:(?:^|.*;\s*)username\s*\=\s*([^;]*).*$)|^.*$/,"$1"):void 0}function drawSMPTEBars(e,t){let n=e.width,o=e.height,a=[["fff","ffe500","00ffd7","0fe000","ff00fe","e30013","0000ff"],["0000ff","353535","ff00fe","676767","00ffd7","353535","fff"],["006261","fff","00196b","676767","8d8d8d","353535"]],r=[75,5,20],d=0,p=0;for(let e in a){let i=r[e]/100*o,c=n/a[e].length;for(let n in a[e])t.fillStyle="#"+a[e][n],t.fillRect(d,p,c,i),d+=c;p+=i,d=0}t.fillStyle="#000",t.fillRect(0,(o-o/5-.05*o)/2,n,o/5+.05*o),t.font=Math.floor(o/5)+"px monospace",t.textBaseline="middle",t.textAlign="center",t.fillStyle="#fff",t.fillText("NO SIGNAL",n/2,o/2)}$("document").ready(function(){let e=document.getElementById("screen").getContext("2d");function t(e){e.style.opacity="0",setTimeout(function(e){e.className=e.className.replace("modal-active",""),e.style.opacity=""},200,e)}function n(e){e&&(e.style.opacity="0",e.className+=" modal-active",setTimeout(function(){e.style.opacity="100"},10))}e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.filter="saturate(130%)",(connection=new WebSocket("ws://localhost:"+prompt("Enter port","3074"))).binaryType="arraybuffer",connection.onopen=function(){console.log("Connection opened");let e=encodeCommand(["username","guest"+Math.floor(9999*Math.random(0,9999))]);connection.send(e),connection.send("7.connect,4.emu1;")},connection.onmessage=function(e){if(e.data instanceof ArrayBuffer)_video_js__WEBPACK_IMPORTED_MODULE_0__.a.onUpdate(e.data);else{console.log("text message: "+e.data);let t=decodeCommand(e.data);if(0==t.length)return;switch(t[0]){case"chat":app.onchat(t);break;case"list":app.onlist(t);break;default:console.log("Unimplemented command: "+t[0])}}},connection.onclose=function(){console.log("Connection closed.")},connection.onerror=function(){console.log("Connection error.")},sendMessage=function(){let e=document.getElementById("chat-input-box").value.trim();console.log("'"+e+"'"),connection.send("4.chat,"+e.length+"."+e+";"),document.getElementById("chat-input-box").value=""},document.getElementById("chat-input-box").onkeyup=function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),sendMessage())},document.getElementById("send-btn").onclick=sendMessage,document.getElementById("screen").onkeydown=function(e){void 0===app.input.keyToRetroID[e.key]||e.repeat||(e.preventDefault(),connection.send(encodeCommand(["button","down",app.input.keyToRetroID[e.key]+""])))},document.getElementById("screen").onkeyup=function(e){void 0===app.input.keyToRetroID[e.key]||e.repeat||(e.preventDefault(),connection.send(encodeCommand(["button","up",app.input.keyToRetroID[e.key]+""])))},window.addEventListener("gamepadconnected",app.input.gamepad.onconnect),window.addEventListener("gamepaddisconnected",app.input.gamepad.ondisconnect),$(document).on("click",".modal",function(e){var n=$(e.target||e.srcElement);n.is(".modal")&&t(n[0])});let o=document.getElementsByClassName("modal")||[];for(let e=0;e<o.length;++e){let n=o[e];n.onkeyup=function(e){"Escape"===e.key&&t(n)}}document.getElementById("keybindings-cancel").onclick=function(e){t(document.getElementsByClassName("modal-active")[0])},document.getElementById("username-cancel").onclick=function(e){t(document.getElementsByClassName("modal-active")[0])},document.getElementById("settings-username").onclick=function(e){n(document.getElementById("username-modal")),document.getElementById("username-input").value=getUsername()},document.getElementById("settings-keybindings").onclick=function(e){n(document.getElementById("keybind-modal"))},document.getElementById("emu-view").onclick=function(e){console.log(e);let t=e.srcElement||e.target;"settings-btn"!=t.id&&"material-icons"!=t.className&&(document.getElementById("settings-popup").style.display="none")},document.getElementById("settings-btn").onclick=function(e){document.getElementById("settings-popup").style.display="flex"}})},function(e,t,n){"use strict";var o={joystickThreshold:.2,retroJoypad:Object.freeze({B:0,Y:1,Select:2,Start:3,Up:4,Down:5,Left:6,Right:7,A:8,X:9,L:10,R:11,L2:12,R2:13,L3:14,R3:15}),maps:{standard:{buttons:[retroJoypad.B,retroJoypad.A,retroJoypad.Y,retroJoypad.X,retroJoypad.L,retroJoypad.R,retroJoypad.L2,retroJoypad.R2,retroJoypad.Select,retroJoypad.Start,retroJoypad.L3,retroJoypad.R3,retroJoypad.Up,retroJoypad.Down,retroJoypad.Left,retroJoypad.Right],axes:[new a(retroJoypad.Left,retroJoypad.Right),new a(retroJoypad.Up,retroJoypad.Down),new a(retroJoypad.Left,retroJoypad.Right),new a(retroJoypad.Up,retroJoypad.Down)]},"Performance Designed Products Afterglow Gamepad for Xbox 360 (Vendor: 0e6f Product: 0213)":{buttons:[retroJoypad.B,retroJoypad.A,retroJoypad.Y,retroJoypad.X,retroJoypad.L,retroJoypad.R,retroJoypad.Select,retroJoypad.Start,void 0,retroJoypad.L3,retroJoypad.R3],axes:[new a(retroJoypad.Left,retroJoypad.Right),new a(retroJoypad.Up,retroJoypad.Down),new a(void 0,retroJoypad.L2),new a(retroJoypad.Left,retroJoypad.Right),new a(retroJoypad.Up,retroJoypad.Down),new a(void 0,retroJoypad.R2),new a(retroJoypad.Left,retroJoypad.Right),new a(retroJoypad.Up,retroJoypad.Down)]},"(null) usb gamepad            (Vendor: 0810 Product: e501)":{buttons:[retroJoypad.X,retroJoypad.A,retroJoypad.B,retroJoypad.Y,retroJoypad.L,void 0,retroJoypad.R,void 0,retroJoypad.Select,retroJoypad.Start],axes:[new a(retroJoypad.Left,retroJoypad.Right),new a(retroJoypad.Up,retroJoypad.Down)]}}};function a(e,t){return{IDifNegative:e,IDifPositive:t,getRetroID:function(e){if(!(e<-1||e>1||Math.abs(e)<joystickThreshold))return e<0?this.IDifNegative:this.IDifPositive}}}t.a=o}]);