!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";const a=Object.freeze({B:0,Y:1,Select:2,Start:3,Up:4,Down:5,Left:6,Right:7,A:8,X:9,L:10,R:11,L2:12,R2:13,L3:14,R3:15});t.a=a},function(e,t,n){"use strict";const a={encode:function(e){for(var t="",n=0;n<e.length;n++){var a=e[n];t+=a.length+"."+a,t+=n<e.length-1?",":";"}return t},decode:function(e){var t=-1,n=[];for(let o=0;o<25;++o){var a=e.indexOf(".",t+1);if(-1==a)break;if(t=parseInt(e.slice(t+1,a))+a+1,n.push(e.slice(a+1,t).replace(/&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&#x2F;/g,"/").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),";"==e.slice(t,t+1))break}return n}};t.a=a},function(e,t,n){"use strict";var a=n(0),o=.2;function s(e,t){this.IDifNegative=e,this.IDifPositive=t,this.getRetroID=function(e){if(!(e<-1||e>1||Math.abs(e)<o))return e<0?self.IDifNegative:self.IDifPositive}}t.a=function(e){var t=this;this.maps={standard:{buttons:[a.a.B,a.a.A,a.a.Y,a.a.X,a.a.L,a.a.R,a.a.L2,a.a.R2,a.a.Select,a.a.Start,a.a.L3,a.a.R3,a.a.Up,a.a.Down,a.a.Left,a.a.Right],axes:[new s(a.a.Left,a.a.Right),new s(a.a.Up,a.a.Down),new s(a.a.Left,a.a.Right),new s(a.a.Up,a.a.Down)]}},this.currentLayout={},this.isConnected=!1,this.lastPolledTimestamp=0,this.pollInputID=void 0,this.buttonState=[],this.axesState=[],this.onConnect=function(e){0===e.gamepad.index&&("standard"===e.gamepad.mapping?(t.currentLayout=t.maps.standard,t.isConnected=!0,t.pollInput()):t.maps[e.gamepad.id]?(t.currentLayout=maps[e.gamepad.id],t.isConnected=!0,t.pollInput()):alert("Unknown controller plugged in"))},window.addEventListener("gamepadconnected",this.onConnect),this.onDisconnect=function(e){0===e.gamepad.index&&(t.isConnected=!1,t.buttonState=[],cancelAnimationFrame(t.pollInputID))},window.addEventListener("gamepaddisconnected",this.onDisconnect),this.pollInput=function(){if(!0===t.isConnected){let n=navigator.getGamepads()[0];if(t.lastPolledTimestamp===n.timestamp)return void(t.pollInputID=requestAnimationFrame(t.pollInput));t.lastPolledTimestamp=n.timestamp;let a=t.currentLayout;if(a){for(let o=0;o<a.buttons.length;++o)void 0===t.buttonState[o]&&(t.buttonState[o]=!1),n.buttons[o].pressed!==t.buttonState[o]&&(n.buttons[o].pressed?e.send("button","down",a.buttons[o]+""):e.send("button","up",a.buttons[o]+"")),t.buttonState[o]=n.buttons[o].pressed;for(let o=0;o<a.axes.length;++o){let s;s=Math.abs(n.axes[o])>t.analogThreshold?n.axes[o]<0?-1:1:0,void 0===t.axesState[o]&&(t.axesState[o]=0);let i=t.axesState[o];i!=s&&(0===i?e.send("button","down",a.axes[o].getRetroID(s)+""):0===s?e.send("button","up",a.axes[o].getRetroID(s)+""):(e.send("button","up",a.axes[o].getRetroID(s)+""),e.send("button","down",a.axes[o].getRetroID(s)+""))),t.axesState[o]=s}}else console.log("layout not setup")}t.pollInputID=requestAnimationFrame(t.pollInput)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var _LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function LetsPlaySocket(wsURI,client){var self=this,username=localStorage.getItem("username")||"";this.pendingValidation=!1,this.send=function(){rawSocket.readyState===WebSocket.OPEN&&rawSocket.send(_LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__.a.encode(arguments))},this.onChat=function(command){let message=command[2].replace(/(\\x[\da-f]{2}|\\u[\da-f]{4}|\\u{1[\da-f]{4}})+/g,function a(x){return eval("'"+x+"'")});client.appendMessage(command[1],message)},this.onList=function(e){client.appendMessage("[Server]","Users online: "+(e.length-1))},this.onUsername=function(e){!self.pendingValidation||"0"!=e[1]&&"1"!=e[1]?client.appendMessage("[Rename]",e[1]+" changed their username to "+e[2]):(self.pendingValidation=!1,"0"===e[1]?client.invalidUsername():"1"===e[1]&&client.validUsername(e[2]))};var rawSocket=new WebSocket(wsURI);this.rawSocket=rawSocket,rawSocket.binaryType="arraybuffer",rawSocket.onopen=function(){console.log("Connection opened"),self.send("username",localStorage.getItem("username")||"guest"+Math.floor(9999*Math.random(0,9999))),self.send("connect","emu1")},rawSocket.onclose=function(){console.log("Connection closed.")},rawSocket.onerror=function(){console.log("Connection error.")},rawSocket.onmessage=function(e){if(e.data instanceof ArrayBuffer)client.display.update(e.data);else{console.log("text message: "+e.data);let t=_LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__.a.decode(e.data);if(0==t.length)return;switch(t[0]){case"chat":self.onChat(t);break;case"list":self.onList(t);break;case"username":self.onUsername(t);break;default:console.log("Unimplemented command: "+t[0])}}}}__webpack_exports__.a=LetsPlaySocket},function(e,t,n){"use strict";var a=n(0),o={keyAsRetroID:{x:a.a.B,c:a.a.A,s:a.a.X,a:a.a.Y,ArrowUp:a.a.Up,ArrowDown:a.a.Down,ArrowLeft:a.a.Left,ArrowRight:a.a.Right,Tab:a.a.Select,Enter:a.a.Start,q:a.a.L,e:a.a.R}};var s=function(){let e=document.getElementById("screen").getContext("2d");e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.filter="saturate(130%)";var t=-1,n=-1;this.update=function(e){let a=new Uint8Array(e);var o=Array.prototype.map.call(a,function(e){return String.fromCharCode(e)}).join("");let s=btoa(o);var i=new Image;i.addEventListener("load",function(){var e=document.getElementById("screen");if(e.getContext){if(t!=i.width||n!=i.height){t=i.width,n=i.height;let a=i.width/i.height,o=parseFloat(getComputedStyle(document.documentElement).fontSize),s=parseFloat(window.getComputedStyle(document.getElementsByClassName("display-container")[0]).height)-2*o,l=a*s,c=s;e.width=l,e.height=c,document.getElementById("screen").style.height=c+"px !important",document.getElementById("screen").style.width=l+"px !important"}var a=e.getContext("2d");a.imageSmoothingEnabled=!1,a.drawImage(i,0,0,e.width,e.height)}}),i.src="data:image/jpeg;base64,"+s},this.drawSMPTEBars=function(e,t){let n=e.width,a=e.height,o=[["fff","ffe500","00ffd7","0fe000","ff00fe","e30013","0000ff"],["0000ff","353535","ff00fe","676767","00ffd7","353535","fff"],["006261","fff","00196b","676767","8d8d8d","353535"]],s=[75,5,20],i=0,l=0;for(let e in o){let c=s[e]/100*a,r=n/o[e].length;for(let n in o[e])t.fillStyle="#"+o[e][n],t.fillRect(i,l,r,c),i+=r;l+=c,i=0}t.fillStyle="#000",t.fillRect(0,(a-a/5-.05*a)/2,n,a/5+.05*a),t.font=Math.floor(a/5)+"px monospace",t.textBaseline="middle",t.textAlign="center",t.fillStyle="#fff",t.fillText("NO SIGNAL",n/2,a/2)}};t.a=function(){var e,t=this;this.display=new s,this.connection={},this.connection,this.appendMessage=function(e,t){let n=document.getElementById("chat-list-items"),a=document.createElement("div");a.className="chat-item",a.innerHTML='<p class="username">'+e+'</p><p class="separator">:</p><span class="chat-text">'+t+"</span>",n.appendChild(a),n.scrollTop=n.scrollHeight},this.sendChatboxContent=function(){let t=document.getElementById("chat-input-box").value.trim();e.send("chat",t),document.getElementById("chat-input-box").value=""},this.hideModal=function(e){e.style.opacity="0",setTimeout(function(e){e.className=e.className.replace("modal-active",""),e.style.opacity=""},200,e)},this.showModal=function(e){e&&(e.style.opacity="0",e.className+=" modal-active",setTimeout(function(){e.style.opacity="100"},10))},this.updateSocket=function(n){t.connection=n.socket,n.socket,e=n},this.invalidUsername=function(){document.getElementById("username-modal-subtitle").style.color="#e42e2e",document.getElementsByClassName("username-group")[0].className+=" shake-horizontal",setTimeout(function(){document.getElementById("username-modal-subtitle").style.color=""},500),setTimeout(function(){document.getElementsByClassName("username-group")[0].className=document.getElementsByClassName("username-group")[0].className.replace(" shake-horizontal","")},900)},this.validUsername=function(e){localStorage.setItem("username",e),t.hideModal(document.getElementsByClassName("modal-active")[0])},this.setUsername=function(t){e.pendingValidation||e.rawSocket.readyState!=WebSocket.OPEN||(e.pendingValidation=!0,e.send("username",t))},$(document).on("click",".modal",function(e){var n=$(e.target||e.srcElement);n.is(".modal")&&t.hideModal(n[0])});let n=document.getElementsByClassName("modal")||[];for(let e=0;e<n.length;++e){let a=n[e];a.onkeyup=function(e){"Escape"===e.key&&t.hideModal(a)}}document.getElementById("keybindings-cancel").onclick=function(e){t.hideModal(document.getElementsByClassName("modal-active")[0])},document.getElementById("username-cancel").onclick=function(e){t.hideModal(document.getElementsByClassName("modal-active")[0])},document.getElementById("username-submit").onclick=function(e){t.setUsername(document.getElementById("username-input").value||"")},document.getElementById("settings-username").onclick=function(e){t.showModal(document.getElementById("username-modal")),document.getElementById("username-input").value=localStorage.getItem("username")||""},document.getElementById("settings-keybindings").onclick=function(e){t.showModal(document.getElementById("keybind-modal"))},document.getElementById("chat-input-box").onkeyup=function(e){("Enter"==e.key||13==e.keyCode&&!e.shiftKey)&&(e.preventDefault(),t.sendChatboxContent())},document.getElementById("username-input").onkeyup=function(e){"Enter"!=e.key&&13!=e.keyCode||(e.preventDefault(),t.setUsername(document.getElementById("username-input").value||""))},document.getElementById("send-btn").onclick=t.sendChatboxContent,document.getElementById("screen").onkeydown=function(t){void 0===o.keyAsRetroID[t.key]||t.repeat||(t.preventDefault(),e.send("button","down",o.keyAsRetroID[t.key]+""))},document.getElementById("screen").onkeyup=function(t){void 0===o.keyAsRetroID[t.key]||t.repeat||(t.preventDefault(),e.send("button","up",o.keyAsRetroID[t.key]+""))},document.getElementById("emu-view").onclick=function(e){let t=e.srcElement||e.target;"settings-btn"!=t.id&&"material-icons"!=t.className&&(document.getElementById("settings-popup").style.display="none")},document.getElementById("settings-btn").onclick=function(e){document.getElementById("settings-popup").style.display="flex"}}},function(e,t,n){"use strict";n.r(t),function(e){var t=n(2),a=n(4),o=n(3);$("document").ready(function(){var n=new a.a,s=new o.a("ws://localhost"+prompt("Dev port","3074"),n);n.updateSocket(s);var i=new t.a(s.socket);e.LetsPlay={Client:n,Display:display,GamepadManager:i}})}.call(this,n(6))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n}]);