!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";const o=Object.freeze({B:0,Y:1,Select:2,Start:3,Up:4,Down:5,Left:6,Right:7,A:8,X:9,L:10,R:11,L2:12,R2:13,L3:14,R3:15});t.a=o},function(e,t,n){"use strict";const o={encode:function(e){for(var t="",n=0;n<e.length;n++){var o=e[n];t+=o.length+"."+o,t+=n<e.length-1?",":";"}return t},decode:function(e){var t=-1,n=[];for(let a=0;a<25;++a){var o=e.indexOf(".",t+1);if(-1==o)break;if(t=parseInt(e.slice(t+1,o))+o+1,n.push(e.slice(o+1,t).replace(/&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&#x2F;/g,"/").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),";"==e.slice(t,t+1))break}return n}};t.a=o},function(e,t,n){"use strict";var o=n(0),a=.2;function s(e,t){this.IDifNegative=e,this.IDifPositive=t,this.getRetroID=function(e){if(!(e<-1||e>1||Math.abs(e)<a))return e<0?self.IDifNegative:self.IDifPositive}}t.a=function(e){var t=this;this.maps={standard:{buttons:[o.a.B,o.a.A,o.a.Y,o.a.X,o.a.L,o.a.R,o.a.L2,o.a.R2,o.a.Select,o.a.Start,o.a.L3,o.a.R3,o.a.Up,o.a.Down,o.a.Left,o.a.Right],axes:[new s(o.a.Left,o.a.Right),new s(o.a.Up,o.a.Down),new s(o.a.Left,o.a.Right),new s(o.a.Up,o.a.Down)]}},this.currentLayout={},this.isConnected=!1,this.lastPolledTimestamp=0,this.pollInputID=void 0,this.buttonState=[],this.axesState=[],this.onConnect=function(e){0===e.gamepad.index&&("standard"===e.gamepad.mapping?(t.currentLayout=t.maps.standard,t.isConnected=!0,t.pollInput()):t.maps[e.gamepad.id]?(t.currentLayout=maps[e.gamepad.id],t.isConnected=!0,t.pollInput()):alert("Unknown controller plugged in"))},window.addEventListener("gamepadconnected",this.onConnect),this.onDisconnect=function(e){0===e.gamepad.index&&(t.isConnected=!1,t.buttonState=[],cancelAnimationFrame(t.pollInputID))},window.addEventListener("gamepaddisconnected",this.onDisconnect),this.pollInput=function(){if(!0===t.isConnected){let n=navigator.getGamepads()[0];if(t.lastPolledTimestamp===n.timestamp)return void(t.pollInputID=requestAnimationFrame(t.pollInput));t.lastPolledTimestamp=n.timestamp;let o=t.currentLayout;if(o){for(let a=0;a<o.buttons.length;++a)void 0===t.buttonState[a]&&(t.buttonState[a]=!1),n.buttons[a].pressed!==t.buttonState[a]&&(n.buttons[a].pressed?e.send("button","down",o.buttons[a]+""):e.send("button","up",o.buttons[a]+"")),t.buttonState[a]=n.buttons[a].pressed;for(let a=0;a<o.axes.length;++a){let s;s=Math.abs(n.axes[a])>t.analogThreshold?n.axes[a]<0?-1:1:0,void 0===t.axesState[a]&&(t.axesState[a]=0);let i=t.axesState[a];i!=s&&(0===i?e.send("button","down",o.axes[a].getRetroID(s)+""):0===s?e.send("button","up",o.axes[a].getRetroID(s)+""):(e.send("button","up",o.axes[a].getRetroID(s)+""),e.send("button","down",o.axes[a].getRetroID(s)+""))),t.axesState[a]=s}}else console.log("layout not setup")}t.pollInputID=requestAnimationFrame(t.pollInput)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var _LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function LetsPlaySocket(wsURI,client){var self=this,username=localStorage.getItem("username")||"";this.pendingValidation=!1,this.send=function(){rawSocket.readyState===WebSocket.OPEN&&rawSocket.send(_LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__.a.encode(arguments))},this.onChat=function(command){let message=command[2].replace(/(\\x[\da-f]{2}|\\u[\da-f]{4}|\\u{1[\da-f]{4}})+/g,function a(x){return eval("'"+x+"'")});client.appendMessage(command[1],message)},this.onList=function(e){client.updateUserList(e.slice(1))},this.onUsername=function(e){!self.pendingValidation||"0"!=e[1]&&"1"!=e[1]?client.renameUser(e[1],e[2]):(self.pendingValidation=!1,"0"===e[1]?client.invalidUsername():"1"===e[1]&&client.validUsername(e[2]))},this.onJoin=function(e){client.addUser(e[1])},this.onLeave=function(e){client.removeUser(e[1])};var rawSocket=new WebSocket(wsURI);this.rawSocket=rawSocket,rawSocket.binaryType="arraybuffer",rawSocket.onopen=function(){console.log("Connection opened"),self.send("username",localStorage.getItem("username")||"guest"+Math.floor(9999*Math.random(0,9999))),self.send("connect","emu1"),self.send("list")},rawSocket.onclose=function(){console.log("Connection closed.")},rawSocket.onerror=function(){console.log("Connection error.")},rawSocket.onmessage=function(e){if(e.data instanceof ArrayBuffer)client.display.update(e.data);else{console.log("text message: "+e.data);let t=_LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__.a.decode(e.data);if(0==t.length)return;switch(t[0]){case"chat":self.onChat(t);break;case"list":self.onList(t);break;case"username":self.onUsername(t);break;case"join":self.onJoin(t);break;case"leave":self.onLeave(t);break;default:console.log("Unimplemented command: "+t[0])}}}}__webpack_exports__.a=LetsPlaySocket},function(e,t,n){"use strict";var o=n(0),a={keyAsRetroID:{x:o.a.B,c:o.a.A,s:o.a.X,a:o.a.Y,ArrowUp:o.a.Up,ArrowDown:o.a.Down,ArrowLeft:o.a.Left,ArrowRight:o.a.Right,Tab:o.a.Select,Enter:o.a.Start,q:o.a.L,e:o.a.R}};var s=function(){let e=document.getElementById("screen").getContext("2d");e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.filter="saturate(130%)";var t=-1,n=-1;this.update=function(e){let o=new Uint8Array(e);var a=Array.prototype.map.call(o,function(e){return String.fromCharCode(e)}).join("");let s=btoa(a);var i=new Image;i.addEventListener("load",function(){var e=document.getElementById("screen");if(e.getContext){if(t!=i.width||n!=i.height){t=i.width,n=i.height;let o=i.width/i.height,a=parseFloat(getComputedStyle(document.documentElement).fontSize),s=parseFloat(window.getComputedStyle(document.getElementsByClassName("display-container")[0]).height)-2*a,l=o*s,c=s;e.width=l,e.height=c,document.getElementById("screen").style.height=c+"px !important",document.getElementById("screen").style.width=l+"px !important"}var o=e.getContext("2d");o.imageSmoothingEnabled=!1,o.drawImage(i,0,0,e.width,e.height)}}),i.src="data:image/jpeg;base64,"+s},this.drawSMPTEBars=function(e,t){let n=e.width,o=e.height,a=[["fff","ffe500","00ffd7","0fe000","ff00fe","e30013","0000ff"],["0000ff","353535","ff00fe","676767","00ffd7","353535","fff"],["006261","fff","00196b","676767","8d8d8d","353535"]],s=[75,5,20],i=0,l=0;for(let e in a){let c=s[e]/100*o,r=n/a[e].length;for(let n in a[e])t.fillStyle="#"+a[e][n],t.fillRect(i,l,r,c),i+=r;l+=c,i=0}t.fillStyle="#000",t.fillRect(0,(o-o/5-.05*o)/2,n,o/5+.05*o),t.font=Math.floor(o/5)+"px monospace",t.textBaseline="middle",t.textAlign="center",t.fillStyle="#fff",t.fillText("NO SIGNAL",n/2,o/2)}};function i(e,t){e.className=e.className.replace(t," ").trim().replace(/\s{2,}/," ")}t.a=function(){var e,t=this;this.display=new s,this.connection={},this.connection,this.onlineUsers=[],this.appendMessage=function(e,t){let n=document.getElementById("chat-list-items"),o=document.createElement("div");o.className="chat-item",o.innerHTML='<p class="username">'+e+'</p><p class="separator">:</p><span class="chat-text">'+t+"</span>",n.appendChild(o),n.scrollTop=n.scrollHeight},this.sendChatboxContent=function(){let t=document.getElementById("chat-input-box").value.trim();e.send("chat",t),document.getElementById("chat-input-box").value=""},this.hideModal=function(e){e.style.opacity="0",setTimeout(function(e){e.className=e.className.replace("modal-active",""),e.style.opacity=""},200,e)},this.showModal=function(e){e&&(e.style.opacity="0",e.className+=" modal-active",setTimeout(function(){e.style.opacity="100"},10))},this.updateSocket=function(n){t.connection=n.socket,n.socket,e=n},this.invalidUsername=function(){document.getElementById("username-modal-subtitle").style.color="#e42e2e",document.getElementsByClassName("username-group")[0].className+=" shake-horizontal",setTimeout(function(){document.getElementById("username-modal-subtitle").style.color=""},500),setTimeout(function(){document.getElementsByClassName("username-group")[0].className=document.getElementsByClassName("username-group")[0].className.replace(" shake-horizontal","")},900)},this.validUsername=function(e){localStorage.setItem("username",e),t.hideModal(document.getElementsByClassName("modal-active")[0])},this.setUsername=function(t){e.pendingValidation||e.rawSocket.readyState!=WebSocket.OPEN||(e.pendingValidation=!0,e.send("username",t))},this.updateUserList=function(e){t.onlineUsers=e,t.onlineUsers.sort();let n=document.querySelector("#user-list");n.innerHTML="";for(let t in e)n.innerHTML+='<div class="user-list-item">\n                                       <p>'+e[t]+"</p>\n                                   </div>";t.updateUserCount()},t=this,this.updateUserCount=function(){let e=t.onlineUsers.length,n="";n+=0===e?"No Users":1===e?"1 User":e+" Users",n+=" Online",$("#user-list-title").children().first().text(n)},this.addUser=function(e){t.onlineUsers.push(e),t.onlineUsers.sort(),t.updateUserList(t.onlineUsers)},this.removeUser=function(e){t.updateUserList(t.onlineUsers.filter(t=>t!==e))},this.renameUser=function(e,n){let o=t.onlineUsers.indexOf(e);-1!==o&&(t.onlineUsers[o]=n),t.updateUserList(t.onlineUsers)},$(document).on("click",".modal",function(e){let n=$(e.target||e.srcElement);n.is(".modal")&&t.hideModal(n[0])});let n=document.getElementsByClassName("modal")||[];for(let e=0;e<n.length;++e){let o=n[e];o.onkeyup=function(e){"Escape"===e.key&&t.hideModal(o)}}document.getElementById("keybindings-cancel").onclick=function(e){t.hideModal(document.getElementsByClassName("modal-active")[0])},document.getElementById("username-cancel").onclick=function(e){t.hideModal(document.getElementsByClassName("modal-active")[0])},document.getElementById("username-submit").onclick=function(e){t.setUsername(document.getElementById("username-input").value||"")},document.getElementById("settings-username").onclick=function(e){t.showModal(document.getElementById("username-modal")),document.getElementById("username-input").value=localStorage.getItem("username")||""},document.getElementById("settings-keybindings").onclick=function(e){t.showModal(document.getElementById("keybind-modal"))},document.getElementById("chat-input-box").onkeyup=function(e){("Enter"==e.key||13==e.keyCode&&!e.shiftKey)&&(e.preventDefault(),t.sendChatboxContent())},document.getElementById("username-input").onkeyup=function(e){"Enter"!=e.key&&13!=e.keyCode||(e.preventDefault(),t.setUsername(document.getElementById("username-input").value||""))},document.getElementById("send-btn").onclick=t.sendChatboxContent,document.getElementById("screen").onkeydown=function(t){void 0===a.keyAsRetroID[t.key]||t.repeat||(t.preventDefault(),e.send("button","down",a.keyAsRetroID[t.key]+""))},document.getElementById("screen").onkeyup=function(t){void 0===a.keyAsRetroID[t.key]||t.repeat||(t.preventDefault(),e.send("button","up",a.keyAsRetroID[t.key]+""))},document.getElementById("emu-view").onclick=function(e){let t=e.srcElement||e.target;"settings-btn"!=t.id&&"material-icons"!=t.className&&(document.getElementById("settings-popup").style.display="none")},document.getElementById("settings-btn").onclick=function(e){document.getElementById("settings-popup").style.display="flex"},document.getElementById("user-list-close").onclick=function(){i(document.getElementById("user-list-pane"),"d-flex"),document.getElementById("chat-pane").className+=" d-flex"},document.getElementById("list-btn").onclick=function(){i(document.getElementById("chat-pane"),"d-flex"),document.getElementById("user-list-pane").className+=" d-flex"}}},function(e,t,n){"use strict";n.r(t),function(e){var t=n(2),o=n(4),a=n(3);$("document").ready(function(){var n=new o.a,s=new a.a("ws://localhost"+prompt("Dev port","3074"),n);n.updateSocket(s);var i=new t.a(s);e.LetsPlay={Client:n,Display:display,GamepadManager:i,Socket:s}})}.call(this,n(6))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n}]);