!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";const o=Object.freeze({B:0,Y:1,Select:2,Start:3,Up:4,Down:5,Left:6,Right:7,A:8,X:9,L:10,R:11,L2:12,R2:13,L3:14,R3:15});t.a=o},function(e,t,n){"use strict";const o={encode:function(e){for(var t="",n=0;n<e.length;n++){var o=e[n];t+=o.length+"."+o,t+=n<e.length-1?",":";"}return t},decode:function(e){var t=-1,n=[];for(let a=0;a<25;++a){var o=e.indexOf(".",t+1);if(-1==o)break;if(t=parseInt(e.slice(t+1,o))+o+1,n.push(e.slice(o+1,t).replace(/&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&#x2F;/g,"/").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),";"==e.slice(t,t+1))break}return n}};t.a=o},function(e,t,n){"use strict";var o=n(1),a=n(0),s=.2;function i(e,t){this.IDifNegative=e,this.IDifPositive=t,this.getRetroID=function(e){if(!(e<-1||e>1||Math.abs(e)<s))return e<0?self.IDifNegative:self.IDifPositive}}a.a.B,a.a.A,a.a.X,a.a.Y,a.a.Up,a.a.Down,a.a.Left,a.a.Right,a.a.Select,a.a.Start,a.a.L,a.a.R;t.a=function(e){var t=this;this.maps={standard:{buttons:[a.a.B,a.a.A,a.a.Y,a.a.X,a.a.L,a.a.R,a.a.L2,a.a.R2,a.a.Select,a.a.Start,a.a.L3,a.a.R3,a.a.Up,a.a.Down,a.a.Left,a.a.Right],axes:[new i(a.a.Left,a.a.Right),new i(a.a.Up,a.a.Down),new i(a.a.Left,a.a.Right),new i(a.a.Up,a.a.Down)]}},this.currentLayout={},this.isConnected=!1,this.lastPolledTimestamp=0,this.pollInputID=void 0,this.buttonState=[],this.axesState=[],this.onConnect=function(e){0===e.gamepad.index&&("standard"===e.gamepad.mapping?(t.currentLayout=t.maps.standard,t.isConnected=!0,t.pollInput()):t.maps[e.gamepad.id]?(t.currentLayout=maps[e.gamepad.id],t.isConnected=!0,t.pollInput()):alert("Unknown controller plugged in"))},window.addEventListener("gamepadconnected",this.onConnect),this.onDisconnect=function(e){0===e.gamepad.index&&(t.isConnected=!1,t.buttonState=[],cancelAnimationFrame(t.pollInputID))},window.addEventListener("gamepaddisconnected",this.onDisconnect),this.pollInput=function(){if(!0===t.isConnected){let n=navigator.getGamepads()[0];if(t.lastPolledTimestamp===n.timestamp)return void(t.pollInputID=requestAnimationFrame(t.pollInput));t.lastPolledTimestamp=n.timestamp;let a=t.currentLayout;if(a){for(let s=0;s<a.buttons.length;++s)void 0===t.buttonState[s]&&(t.buttonState[s]=!1),n.buttons[s].pressed!==t.buttonState[s]&&(n.buttons[s].pressed?e.readyState===e.OPEN&&e.send(o.a.encode(["button","down",a.buttons[s]+""])):e.readyState===e.OPEN&&e.send(o.a.encode(["button","up",a.buttons[s]+""]))),t.buttonState[s]=n.buttons[s].pressed;for(let s=0;s<a.axes.length;++s){let i;i=Math.abs(n.axes[s])>t.analogThreshold?n.axes[s]<0?-1:1:0,void 0===t.axesState[s]&&(t.axesState[s]=0);let c=t.axesState[s];c!=i&&(0===c?e.readyState===e.OPEN&&e.send(o.a.encode(["button","down",a.axes[s].getRetroID(i)+""])):0===i?e.readyState===e.OPEN&&e.send(o.a.encode(["button","up",a.axes[s].getRetroID(c)+""])):e.readyState===e.OPEN&&(e.send(o.a.encode(["button","up",a.axes[s].getRetroID(c)+""])),e.send(o.a.encode(["button","down",a.axes[s].getRetroID(i)+""])))),t.axesState[s]=i}}else console.log("layout not setup")}t.pollInputID=requestAnimationFrame(t.pollInput)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var _LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function LetsPlaySocket(wsURI,client){var self=this;this.onChat=function(command){let message=command[2].replace(/(\\x[\da-f]{2}|\\u[\da-f]{4}|\\u{1[\da-f]{4}})+/g,function a(x){return eval("'"+x+"'")});client.appendMessage(command[1],message)},this.onList=function(e){client.appendMessage("[Server]","Users online: "+(e.length-1))};var socket=new WebSocket(wsURI);this.socket=socket,socket.binaryType="arraybuffer",socket.onopen=function(){console.log("Connection opened");let e="guest"+Math.floor(9999*Math.random(0,9999)),t=_LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__.a.encode(["username",e]);socket.send(t),socket.send("7.connect,4.emu1;")},socket.onclose=function(){console.log("Connection closed.")},socket.onerror=function(){console.log("Connection error.")},socket.onmessage=function(e){if(e.data instanceof ArrayBuffer)client.display.update(e.data);else{console.log("text message: "+e.data);let t=_LetsPlayProtocol_js__WEBPACK_IMPORTED_MODULE_0__.a.decode(e.data);if(0==t.length)return;switch(t[0]){case"chat":self.onChat(t);break;case"list":self.onList(t);break;default:console.log("Unimplemented command: "+t[0])}}}}__webpack_exports__.a=LetsPlaySocket},function(e,t,n){"use strict";var o=n(0),a={keyAsRetroID:{x:o.a.B,c:o.a.A,s:o.a.X,a:o.a.Y,ArrowUp:o.a.Up,ArrowDown:o.a.Down,ArrowLeft:o.a.Left,ArrowRight:o.a.Right,Tab:o.a.Select,Enter:o.a.Start,q:o.a.L,e:o.a.R}};var s=function(){let e=document.getElementById("screen").getContext("2d");e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.filter="saturate(130%)";var t=-1,n=-1;this.update=function(e){let o=new Uint8Array(e);var a=Array.prototype.map.call(o,function(e){return String.fromCharCode(e)}).join("");let s=btoa(a);var i=new Image;i.addEventListener("load",function(){var e=document.getElementById("screen");if(e.getContext){if(t!=i.width||n!=i.height){t=i.width,n=i.height;let o=i.width/i.height,a=parseFloat(getComputedStyle(document.documentElement).fontSize),s=parseFloat(window.getComputedStyle(document.getElementsByClassName("display-container")[0]).height)-2*a,c=o*s,l=s;e.width=c,e.height=l,document.getElementById("screen").style.height=l+"px !important",document.getElementById("screen").style.width=c+"px !important"}var o=e.getContext("2d");o.imageSmoothingEnabled=!1,o.drawImage(i,0,0,e.width,e.height)}}),i.src="data:image/jpeg;base64,"+s},this.drawSMPTEBars=function(e,t){let n=e.width,o=e.height,a=[["fff","ffe500","00ffd7","0fe000","ff00fe","e30013","0000ff"],["0000ff","353535","ff00fe","676767","00ffd7","353535","fff"],["006261","fff","00196b","676767","8d8d8d","353535"]],s=[75,5,20],i=0,c=0;for(let e in a){let l=s[e]/100*o,r=n/a[e].length;for(let n in a[e])t.fillStyle="#"+a[e][n],t.fillRect(i,c,r,l),i+=r;c+=l,i=0}t.fillStyle="#000",t.fillRect(0,(o-o/5-.05*o)/2,n,o/5+.05*o),t.font=Math.floor(o/5)+"px monospace",t.textBaseline="middle",t.textAlign="center",t.fillStyle="#fff",t.fillText("NO SIGNAL",n/2,o/2)}},i=n(1);t.a=function(){var e=this;this.display=new s,this.connection={};var t=this.connection;this.appendMessage=function(e,t){console.log("Chat:",e,t);let n=document.getElementById("chat-list-items"),o=document.createElement("div");o.className="chat-item",o.innerHTML='<p class="username">'+e+'</p><p class="separator">:</p><span class="chat-text">'+t+"</span>",n.appendChild(o),n.scrollTop=n.scrollHeight},this.sendChatboxContent=function(){let e=document.getElementById("chat-input-box").value.trim();console.log("'"+e+"'"),console.log(t),t.readyState===WebSocket.OPEN&&t.send(i.a.encode(["chat",e])),document.getElementById("chat-input-box").value=""},this.hideModal=function(e){e.style.opacity="0",setTimeout(function(e){e.className=e.className.replace("modal-active",""),e.style.opacity=""},200,e)},this.showModal=function(e){e&&(e.style.opacity="0",e.className+=" modal-active",setTimeout(function(){e.style.opacity="100"},10))},this.updateSocket=function(n){e.connection=n,t=n},$(document).on("click",".modal",function(t){var n=$(t.target||t.srcElement);n.is(".modal")&&e.hideModal(n[0])});let n=document.getElementsByClassName("modal")||[];for(let t=0;t<n.length;++t){let o=n[t];o.onkeyup=function(t){"Escape"===t.key&&e.hideModal(o)}}document.getElementById("keybindings-cancel").onclick=function(t){e.hideModal(document.getElementsByClassName("modal-active")[0])},document.getElementById("username-cancel").onclick=function(t){e.hideModal(document.getElementsByClassName("modal-active")[0])},document.getElementById("settings-username").onclick=function(t){e.showModal(document.getElementById("username-modal"))},document.getElementById("settings-keybindings").onclick=function(t){e.showModal(document.getElementById("keybind-modal"))},document.getElementById("chat-input-box").onkeyup=function(t){("Enter"==t.key||13==t.keyCode&&!t.shiftKey)&&(t.preventDefault(),e.sendChatboxContent())},document.getElementById("send-btn").onclick=e.sendChatboxContent,document.getElementById("screen").onkeydown=function(t){void 0===a.keyAsRetroID[t.key]||t.repeat||(t.preventDefault(),e.connection.send(i.a.encode(["button","down",a.keyAsRetroID[t.key]+""])))},document.getElementById("screen").onkeyup=function(t){console.log(a.keyAsRetroID[t.key]),console.log(t.key),void 0===a.keyAsRetroID[t.key]||t.repeat||(t.preventDefault(),e.connection.send(i.a.encode(["button","up",a.keyAsRetroID[t.key]+""])))},document.getElementById("emu-view").onclick=function(e){console.log(e);let t=e.srcElement||e.target;"settings-btn"!=t.id&&"material-icons"!=t.className&&(document.getElementById("settings-popup").style.display="none")},document.getElementById("settings-btn").onclick=function(e){document.getElementById("settings-popup").style.display="flex"}}},function(e,t,n){"use strict";n.r(t),function(e){var t=n(2),o=n(4),a=n(3);$("document").ready(function(){var n=new o.a,s=new a.a("ws://localhost"+prompt("Dev port","3074"),n);n.updateSocket(s.socket);var i=new t.a(s.socket);e.LetsPlay={Client:n,Display:display,GamepadManager:i}})}.call(this,n(6))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n}]);